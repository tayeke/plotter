// Generated by CoffeeScript 1.4.0
(function(){var e,t,n=function(e,t){return function(){return e.apply(t,arguments)}};e=function(){function e(){this.dataSuccess=n(this.dataSuccess,this);this.dataError=n(this.dataError,this);this.insertShow=n(this.insertShow,this);this.removeShow=n(this.removeShow,this);this.addShow=n(this.addShow,this);this.getAllShows=n(this.getAllShows,this);this.populateDB=n(this.populateDB,this);this.receivedEvent=n(this.receivedEvent,this);this.domReady=n(this.domReady,this);this.onDeviceReady=n(this.onDeviceReady,this);this.bindEvents=n(this.bindEvents,this);this.shows=[]}e.prototype.bindEvents=function(){return document.addEventListener("deviceready",this.onDeviceReady,!1)};e.prototype.onDeviceReady=function(){this.receivedEvent("deviceready");this.database=window.openDatabase("plotter_development","1.0","Plotter Data",2e5);this.database.transaction(this.populateDB,this.dataError,this.dataSuccess);this.getAllShows();return this.domReady()};e.prototype.domReady=function(){var e=this;return $("#newShow").submit(function(t){var n;t.preventDefault();n=$('input[name="show_title"]');e.insertShow(n.val());return n.val("")})};e.prototype.receivedEvent=function(e){return console.log("Received Event: "+e)};e.prototype.populateDB=function(e){return e.executeSql("CREATE TABLE IF NOT EXISTS SHOWS (id INTEGER PRIMARY KEY AUTOINCREMENT, title varchar(255) NOT NULL, season INTEGER DEFAULT 1, episode INTEGER DEFAULT 1)")};e.prototype.getAllShows=function(){var e,t,n=this;t=function(e,t){var r,i,s,o,u;if(r=t.rows.length){u=[];for(i=s=0,o=r-1;0<=o?s<=o:s>=o;i=0<=o?++s:--s)u.push(n.addShow(t.rows.item(i)));return u}};e=function(e){return e.executeSql("SELECT * FROM SHOWS",n.dataError,t)};return this.database.transaction(e,this.dataError)};e.prototype.addShow=function(e){return this.shows.push(new t(e))};e.prototype.removeShow=function(e){var t;t=this.shows.indexOf(e);return this.shows.splice(t,1)};e.prototype.insertShow=function(e){var n,r,i,s=this;console.log(e);n=function(e,n){return s.shows.push(new t(n.rows.item(0)))};r=function(e,t){return e.executeSql("SELECT * FROM SHOWS WHERE id = "+t.insertId,s.dataError,n)};i=function(t){return t.executeSql("INSERT INTO SHOWS (title) VALUES ('"+e+"')",this.dataError,r)};return this.database.transaction(i,this.dataError)};e.prototype.dataError=function(e){return alert("Sorry there was an error processing data: "+e.code+" : "+e.msg)};e.prototype.dataSuccess=function(){};return e}();t=function(){function e(e){this.remove=n(this.remove,this);this["delete"]=n(this["delete"],this);this.createElement=n(this.createElement,this);this.render=n(this.render,this);this.decrement=n(this.decrement,this);this.increment=n(this.increment,this);this.bindEvents=n(this.bindEvents,this);var t,r;for(t in e){r=e[t];this[t]=r}this.createElement();this.bindEvents();this.render()}e.prototype.bindEvents=function(){var e=this;return this.$el.click(function(t){e["delete"]();e.remove();return app.removeShow(e)})};e.prototype.increment=function(e){var t,n,r=this;t=function(){return r[e]+=1};n=function(n){return n.executeSql("UPDATE SHOWS SET "+e+" = ("+e+" + 1) WHERE id = '"+r.id+"'",app.dataError,t)};return app.database.transaction(n,app.dataError)};e.prototype.decrement=function(e){var t,n,r=this;t=function(){return r[e]-=1};n=function(n){return n.executeSql("UPDATE SHOWS SET "+e+" = ("+e+" - 1) WHERE id = '"+r.id+"'",app.dataError,t)};return app.database.transaction(n,app.dataError)};e.prototype.render=function(){this.$el.html('<a href="#">'+this.title+'<span class="chevron"></span></a>');return $("#shows").append(this.$el)};e.prototype.createElement=function(){return this.$el=$("<li>")};e.prototype["delete"]=function(){var e,t=this;e=function(e){return e.executeSql("DELETE FROM SHOWS WHERE id = '"+t.id+"'",app.dataError)};return app.database.transaction(e,app.dataError)};e.prototype.remove=function(){return this.$el.remove()};return e}();this.app=new e}).call(this);