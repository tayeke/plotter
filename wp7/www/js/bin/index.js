// Generated by CoffeeScript 1.4.0
(function(){var e,t,n,r=function(e,t){return function(){return e.apply(t,arguments)}};e=function(){function e(){this.dataSuccess=r(this.dataSuccess,this);this.dataError=r(this.dataError,this);this.insertShow=r(this.insertShow,this);this.removeShow=r(this.removeShow,this);this.addShow=r(this.addShow,this);this.getAllShows=r(this.getAllShows,this);this.populateDB=r(this.populateDB,this);this.receivedEvent=r(this.receivedEvent,this);this.domReady=r(this.domReady,this);this.onDeviceReady=r(this.onDeviceReady,this);this.bindEvents=r(this.bindEvents,this);this.shows=[];this.bindEvents()}e.prototype.bindEvents=function(){return document.addEventListener("deviceready",this.onDeviceReady,!1)};e.prototype.onDeviceReady=function(){this.receivedEvent("deviceready");this.database=window.openDatabase("plotter_development","1.0","Plotter Data",2e5);this.database.transaction(this.populateDB,this.dataError,this.dataSuccess);this.getAllShows();return this.domReady()};e.prototype.domReady=function(){var e=this;return $("#newShow").submit(function(t){var n;t.preventDefault();n=$('input[name="show_title"]');e.insertShow(n.val());return n.val("")})};e.prototype.receivedEvent=function(e){return console.log("Received Event: "+e)};e.prototype.populateDB=function(e){return e.executeSql("CREATE TABLE IF NOT EXISTS SHOWS (id INTEGER PRIMARY KEY AUTOINCREMENT, title varchar(255) NOT NULL, season INTEGER DEFAULT 1, episode INTEGER DEFAULT 1)")};e.prototype.getAllShows=function(){var e,t,n=this;t=function(e,t){var r,i,s,o,u;if(r=t.rows.length){u=[];for(i=s=0,o=r-1;0<=o?s<=o:s>=o;i=0<=o?++s:--s)u.push(n.addShow(t.rows.item(i)));return u}};e=function(e){return e.executeSql("SELECT * FROM SHOWS",n.dataError,t)};return this.database.transaction(e,this.dataError)};e.prototype.addShow=function(e){return this.shows.push(new t(e))};e.prototype.removeShow=function(e){var t;t=this.shows.indexOf(e);return this.shows.splice(t,1)};e.prototype.insertShow=function(e){var n,r,i,s=this;console.log(e);n=function(e,n){return s.shows.push(new t(n.rows.item(0)))};r=function(e,t){return e.executeSql("SELECT * FROM SHOWS WHERE id = "+t.insertId,s.dataError,n)};i=function(t){return t.executeSql("INSERT INTO SHOWS (title) VALUES ('"+e+"')",this.dataError,r)};return this.database.transaction(i,this.dataError)};e.prototype.dataError=function(e){return alert("Sorry there was an error processing data: "+e.code+" : "+e.msg)};e.prototype.dataSuccess=function(){};return e}();t=function(){function e(e){this.remove=r(this.remove,this);this["delete"]=r(this["delete"],this);this.createElement=r(this.createElement,this);this.render=r(this.render,this);this.decrement=r(this.decrement,this);this.increment=r(this.increment,this);this.bindEvents=r(this.bindEvents,this);var t,n;for(t in e){n=e[t];this[t]=n}this.createElement();this.bindEvents();this.render()}e.prototype.bindEvents=function(){var e=this;return this.$el.click(function(t){e["delete"]();e.remove();return n.removeShow(e)})};e.prototype.increment=function(e){var t,r,i=this;t=function(){return i[e]+=1};r=function(r){return r.executeSql("UPDATE SHOWS SET "+e+" = ("+e+" + 1) WHERE id = '"+i.id+"'",n.dataError,t)};return n.database.transaction(r,n.dataError)};e.prototype.decrement=function(e){var t,r,i=this;t=function(){return i[e]-=1};r=function(r){return r.executeSql("UPDATE SHOWS SET "+e+" = ("+e+" - 1) WHERE id = '"+i.id+"'",n.dataError,t)};return n.database.transaction(r,n.dataError)};e.prototype.render=function(){this.$el.html('<a href="#">'+this.title+'<span class="chevron"></span></a>');return $("#shows").append(this.$el)};e.prototype.createElement=function(){return this.$el=$("<li>")};e.prototype["delete"]=function(){var e,t=this;e=function(e){return e.executeSql("DELETE FROM SHOWS WHERE id = '"+t.id+"'",n.dataError)};return n.database.transaction(e,n.dataError)};e.prototype.remove=function(){return this.$el.remove()};return e}();n=new e}).call(this);